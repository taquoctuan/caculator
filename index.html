<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Calculator</title>
	<style>
        * {
	        margin: 0;
	        padding: 0;
	        box-sizing: border-box;
	        font-family: sans-serif;
        }

        .app {
	        display: flex;
	        justify-content: center;
    	    align-items: center;
	        height: 100vh;
        }

        .calculator {
	        background-color: #22252D;
            width: 100%;
	        max-width: 375px;
	        min-height: 640px;
	        display: flex;
	        flex-direction: column;
    	    border-radius: 1.5rem;
	        overflow: hidden;
        }

        .display {
	        min-height: 200px;
	        padding: 1.5rem;
	        display: flex;
	        justify-content: flex-end;
	        align-items: flex-end;
	        color: white;
            	text-align: right;
	        flex: 1 1 0%;
        }

        .display .content {
	        display: flex;
	        flex-direction: column;
	        justify-content: flex-end;
	        width: 100%;
            max-width: 100%;
	        overflow: auto;
        }

        .display .input {
	        width: 100%;
            font-size: 1.25rem;
	        margin-bottom: 0.5rem;
        }

        .display .output {
	        font-size: 3rem;
	        font-weight: 700;
            width: 100%;
	        white-space: nowrap;
        }

        .display .operator {
	        color: #EB6666;
        }

        .display .brackets,
        .display .percent {
	        color: #26FED7;
        }

        .keys {
	        background-color: #292D36;
	        padding: 1.5rem;
	        border-radius: 1.5rem 1.5rem 0 0;
	        display: grid;
	        grid-template-columns: repeat(4, 1fr);
	        grid-template-rows: repeat(5, 1fr);
            grid-gap: 1rem;
	        box-shadow: 0px -2px 16px rgba(0, 0, 0, 0.2);
        }

        .keys .key {
	        position: relative;
	        cursor: pointer;
	        display: block;
	        height: 0;
	        padding-top: 100%;
	        background-color: #262933;
	        border-radius: 1rem;
            transition: 0.2s;
	        user-select: none;
        }

        .keys .key span {
	        position: absolute;
	        top: 50%;
	        left: 50%;
	        transform: translate(-50%, -50%);
	        font-size: 2rem;
            font-weight: 700;
	        color: #FFF;
        }

        .keys .key:hover {
	        box-shadow: inset 0px 0px 8px rgba(0, 0, 0, 0.2);
        }

        .keys .key.operator span {
	        color: #EB6666;
        }

        .keys .key.action span {
	        color: #26FED7;
        }
    </style>
</head>
<body>
	
	<div class="app">

		<div class="calculator">

			<div class="display">
				<div class="content">
					<div class="input"></div>
					<div class="output"></div>
				</div>
			</div>

			<div class="keys">

				<div data-key="clear" class="key action">
					<span>AC</span>
				</div>

				<div data-key="brackets" class="key action">
					<span>( )</span>
				</div>

				<div data-key="%" class="key action">
					<span>%</span>
				</div>

				<div data-key="/" class="key operator">
					<span>÷</span>
				</div>

				<div data-key="7" class="key">
					<span>7</span>
				</div>

				<div data-key="8" class="key">
					<span>8</span>
				</div>

				<div data-key="9" class="key">
					<span>9</span>
				</div>

				<div data-key="*" class="key operator">
					<span>x</span>
				</div>

				<div data-key="4" class="key">
					<span>4</span>
				</div>

				<div data-key="5" class="key">
					<span>5</span>
				</div>

				<div data-key="6" class="key">
					<span>6</span>
				</div>

				<div data-key="-" class="key operator">
					<span>-</span>
				</div>

				<div data-key="1" class="key">
					<span>1</span>
				</div>

				<div data-key="2" class="key">
					<span>2</span>
				</div>

				<div data-key="3" class="key">
					<span>3</span>
				</div>

				<div data-key="+" class="key operator">
					<span>+</span>
				</div>

				<div data-key="backspace" class="key action">
					<span>&lt;</span>
				</div>

				<div data-key="0" class="key">
					<span>0</span>
				</div>

				<div data-key="." class="key">
					<span>.</span>
				</div>
				
				<div data-key="=" class="key operator">
					<span>=</span>
				</div>
			</div>

		</div>

	</div>

	<script>
        document.addEventListener('DOMContentLoaded', function() {
    const displayInput = document.querySelector('.display .input');
    const displayOutput = document.querySelector('.display .output');
    const keys = document.querySelectorAll('.key');

    let currentInput = ''; // Biến lưu trữ đầu vào hiện tại
    
    /**
     * Hàm tính toán biểu thức với nhiều phép toán
     * @param {string} expr - Biểu thức toán học
     * @returns {number} - Kết quả của phép toán
     */
    function calculateExpression(expr) {
        // Xử lý các phép toán nhân và chia trước
        const multiplyDivide = (expression) => {
            const multiplyDivideRegex = /(\d+(\.\d+)?)\s*([*/])\s*(\d+(\.\d+)?)/g;
            let match;

            while ((match = multiplyDivideRegex.exec(expression)) !== null) {
                const [fullMatch, num1, , operator, num2] = match;
                const result = operator === '*' ? parseFloat(num1) * parseFloat(num2) :
                               operator === '/' ? parseFloat(num1) / parseFloat(num2) : 0;
                expression = expression.replace(fullMatch, result);
            }
            return expression;
        };

        // Xử lý các phép toán cộng và trừ
        const addSubtract = (expression) => {
            const addSubtractRegex = /(\d+(\.\d+)?)\s*([+-])\s*(\d+(\.\d+)?)/g;
            let match;

            while ((match = addSubtractRegex.exec(expression)) !== null) {
                const [fullMatch, num1, , operator, num2] = match;
                const result = operator === '+' ? parseFloat(num1) + parseFloat(num2) :
                               operator === '-' ? parseFloat(num1) - parseFloat(num2) : 0;
                expression = expression.replace(fullMatch, result);
            }
            return expression;
        };

        // Xử lý các phép toán nhân và chia
        expr = multiplyDivide(expr);
        // Xử lý các phép toán cộng và trừ
        expr = addSubtract(expr);

        return parseFloat(expr);
    }

    // Xử lý sự kiện nhấn nút
    keys.forEach(key => {
        key.addEventListener('click', function() {
            const keyValue = this.getAttribute('data-key');

            if (keyValue === 'clear') {
                // Xóa mọi dữ liệu khi nhấn nút AC
                currentInput = '';
                displayInput.textContent = '';
                displayOutput.textContent = '';
            } else if (keyValue === 'backspace') {
                // Xóa ký tự cuối cùng khi nhấn nút <-
                currentInput = currentInput.slice(0, -1);
                displayInput.textContent = currentInput;
            } else if (keyValue === '=') {
                // Tính toán kết quả khi nhấn nút =
                if (currentInput !== '') {
                    try {
                        const result = calculateExpression(currentInput);
                        displayOutput.textContent = result;
                        currentInput = result;
                    } catch (e) {
                        // Hiển thị lỗi nếu có vấn đề trong quá trình tính toán
                        displayOutput.textContent = 'Error';
                    }
                }
            } else if (['+', '-', '*', '/'].includes(keyValue)) {
                // Xử lý toán tử
                if (currentInput !== '' && !['+', '-', '*', '/'].includes(currentInput.slice(-1))) {
                    currentInput += keyValue;
                } else if (currentInput !== '') {
                    // Thay thế toán tử nếu đã có toán tử cuối cùng
                    currentInput = currentInput.slice(0, -1) + keyValue;
                }
                displayInput.textContent = currentInput;
            } else {
                // Thêm ký tự vào đầu vào hiện tại
                currentInput += keyValue;
                displayInput.textContent = currentInput;
            }
        });
    });
});

    </script>
</body>
</html>